<h1 class="display-2 pt-5 pb-5 text-center">Create account</h1>
<p class="lead">
  To create a new account simply choose a username and password, according to the <a routerLink="/help"
                                                                                     [queryParams]="{
                                          s: 'What are the username and password requirements?'
                                          }">requirements</a>.
  Later on you can customize you profile by adding a status or profile picture.
</p>

<div class="alert alert-{{info.type}}" *ngIf="info.message">
  {{info.message}}
</div>

<div *ngIf="error" class="mt-5">
  <div class="text-danger d-flex justify-content-center">
    <p class="lead">The server is currently down. Try again later.</p>
  </div>
  <div class="text-danger d-flex justify-content-center">
    <div>
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor"
           class="bi bi-cloud-slash-fill" viewBox="0 0 16 16">
        <path fill-rule="evenodd"
              d="M3.112 5.112a3.125 3.125 0 0 0-.17.613C1.266 6.095 0 7.555 0 9.318 0 11.366 1.708 13 3.781 13H11L3.112 5.112zm11.372 7.372L4.937 2.937A5.512 5.512 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773a3.2 3.2 0 0 1-1.516 2.711zm-.838 1.87l-12-12 .708-.708 12 12-.707.707z"/>
      </svg>
    </div>
  </div>
</div>

<div class="registerForm" *ngIf="!error">
  <form #registerForm="ngForm" (ngSubmit)="onSubmit()" appRepeatPassword>

    <div class="form-group">
      <label for="registerUsername">Username</label>
      <input id="registerUsername" name="registerUsername" type="text" class="form-control" required
             minlength="2" [(ngModel)]="user.username" #registerUsername="ngModel"
             [ngModelOptions]="{ updateOn: 'blur' }" autocomplete="username"
             appUniqueUsername pattern="^(?=[a-zA-Z0-9-_]{2,16}$)[^_-].*[^_-]$" maxlength="16"
             [readOnly]="disableRegister">

      <small class="form-text text-muted" *ngIf="registerForm.pending">Checking username...</small>
      <div *ngIf="registerUsername.invalid && (registerUsername.dirty || registerUsername.touched)"
           class="invalid-feedback">

        <div *ngIf="registerUsername.errors.required">
          Username is required.
        </div>
        <div *ngIf="registerUsername.errors.pattern">
          Username is not matching the <a routerLink="/help"
                                          [queryParams]="{
                                          s: 'What are the username and password requirements?'
                                          }">requirements</a>.
        </div>
        <div *ngIf="registerUsername.errors?.uniqueError">
          This username is already taken.
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="registerPassword">Password</label>
      <input id="registerPassword" name="registerPassword" type="password" class="form-control"
             [(ngModel)]="user.password" autocomplete="new-password"
             #registerPassword="ngModel" required
             pattern="(^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{5,32}$)"
             [readOnly]="disableRegister">
      <small id="passwordHelp" class="form-text text-muted"
             *ngIf="registerPassword.touched && registerPassword.value">5-32
        characters. At least one
        <span class="font-italic">uppercase</span>,
        one <span class="font-italic">lowercase</span>,
        one <span class="font-italic">number</span> and
        one <span class="font-italic">special character (@$!%*?&)</span>.
      </small>
      <div *ngIf="registerPassword.invalid && (registerPassword.dirty || registerPassword.touched)"
           class="invalid-feedback">

        <div *ngIf="registerPassword.errors.pattern">
          Password is not matching the <a routerLink="/help"
                                          [queryParams]="{
          s: 'What are the username and password requirements?'
          }">requirements</a>.
        </div>
        <div *ngIf="registerPassword.errors.required">
          Password is required.
        </div>
      </div>
    </div>
    <div class="cross-validation"
         [class.cross-validation-error]="registerForm.errors?.NotMatching && (registerForm.touched || registerForm.dirty)">
      <div class="form-group">
        <label for="registerPasswordRepeat">Repeat Password</label>
        <input id="registerPasswordRepeat" name="registerPasswordRepeat" type="password" class="form-control"
               [(ngModel)]="passwordRepeat" autocomplete="new-password"
               #registerPasswordRepeat="ngModel" required
               pattern="(^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{5,32}$)"
               [readOnly]="disableRegister">
        <div
          *ngIf="(registerPasswordRepeat.invalid || registerForm.errors?.NotMatching) && (registerPasswordRepeat.dirty || registerPasswordRepeat.touched)"
          class="invalid-feedback">
          <div *ngIf="registerPasswordRepeat.errors?.required">
            Repeating the password is required.
          </div>
          <div
            *ngIf="registerForm.errors?.NotMatching && !registerPasswordRepeat.errors?.required">
            The repeated password is not the same.
          </div>
        </div>
      </div>
    </div>

    <button type="submit" class="btn btn-success btn-block btn-lg"
            [disabled]="(registerForm.invalid || registerForm.pending || disableRegister || working)">
      <span *ngIf="!working">Register</span>
      <span *ngIf="working">
        <span class="spinner-border">
        </span>
      </span>
    </button>
  </form>
  <button class="btn btn-lg btn-outline-secondary btn-block mt-3" routerLink="/login" *ngIf="!disableRegister">Go to
    Login
  </button>
  <button class="btn btn-lg btn-primary btn-block mt-3" routerLink="/login" *ngIf="disableRegister">Go to
    Login
  </button>
</div>
